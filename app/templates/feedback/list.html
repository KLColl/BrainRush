{% extends "base.html" %}

{% block title %}Feedback - BrainRush{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/feedback.css') }}">
{% endblock %}

{% block content %}
<div class="feedback-container">
    <div class="feedback-header">
        <h1>üí¨ Feedback</h1>
        <p>Share your thoughts and help us improve BrainRush!</p>
    </div>

    {% if current_user.is_authenticated %}
    <div class="add-feedback-section">
        <h2>Leave Your Feedback</h2>
        <form action="{{ url_for('feedback.feedback_add') }}" method="post" class="feedback-form">
            <textarea 
                name="message" 
                class="feedback-textarea"
                placeholder="Share your experience with BrainRush..." 
                maxlength="500"
                required></textarea>
            <div class="char-counter">
                <span id="char-count">0</span> / 500 characters
            </div>
            <button type="submit" class="submit-feedback-btn">Submit Feedback</button>
        </form>
    </div>
    {% else %}
    <div class="add-feedback-section">
        <p style="text-align: center; color: var(--text-secondary);">
            <a href="/auth/login" style="color: var(--accent-color); font-weight: bold;">Log in</a> 
            to leave feedback.
        </p>
    </div>
    {% endif %}

    <div class="feedback-list-section">
        <div class="section-header">
            <h2 class="section-title">All Feedback</h2>
            <span class="feedback-count">{{ feedbacks|length }}</span>
        </div>

        {% if feedbacks %}
        <div class="feedback-list">
            {% for f in feedbacks %}
            <div class="feedback-item">
                <div class="feedback-item-header">
                    <div class="feedback-user-info">
                        <div class="feedback-avatar">{{ f.name[0]|upper }}</div>
                        <div class="feedback-user-details">
                            <div class="feedback-username">{{ f.name }}</div>
                            <div class="feedback-date">
                                <span class="local-time" data-utc="{{ f.created_at }}">{{ f.created_at }}</span>
                            </div>
                        </div>
                    </div>
                    
                    {% if current_user.is_authenticated %}
                        {% if current_user.role == "admin" or current_user.id == f.user_id %}
                        <div class="feedback-actions">
                            <a href="{{ url_for('feedback.feedback_edit', fid=f.id) }}" class="action-btn edit-btn">
                                Edit
                            </a>
                            <form action="{{ url_for('feedback.feedback_delete', fid=f.id) }}" 
                                  method="post" 
                                  style="display:inline;"
                                  onsubmit="return confirm('Are you sure you want to delete this feedback?');">
                                <button type="submit" class="action-btn delete-btn">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    {% endif %}
                </div>

                <div class="feedback-content">
                    <p class="feedback-message">{{ f.message }}</p>
                    {% if f.updated_at %}
                    <span class="updated-badge">Edited</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-feedback">
            <div class="empty-feedback-icon">üí≠</div>
            <h3>No Feedback Yet</h3>
            <p>Be the first to share your thoughts!</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
// –õ—ñ—á–∏–ª—å–Ω–∏–∫ —Å–∏–º–≤–æ–ª—ñ–≤ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.querySelector('.feedback-textarea');
    const charCount = document.getElementById('char-count');
    
    if (textarea && charCount) {
        textarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
    }

    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è UTC —á–∞—Å—É –≤ –ª–æ–∫–∞–ª—å–Ω–∏–π
    document.querySelectorAll('.local-time').forEach(function(el) {
        const utcTime = el.getAttribute('data-utc');
        if (utcTime) {
            const date = new Date(utcTime);
            el.textContent = date.toLocaleString();
        }
    });
});
</script>
{% endblock %}